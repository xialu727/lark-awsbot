# é£ä¹¦AWSå·¥å•æœºå™¨äºº

åŸºäºæ¨¡å—åŒ–æ¶æ„çš„é£ä¹¦AWSå·¥å•æœºå™¨äººï¼Œæ”¯æŒAWS Lambdaæ— æœåŠ¡éƒ¨ç½²ï¼Œå¸®åŠ©ç”¨æˆ·é€šè¿‡é£ä¹¦å¿«é€Ÿåˆ›å»ºå’Œç®¡ç†AWSå·¥å•ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¤– **æ™ºèƒ½äº¤äº’**ï¼šæ”¯æŒå…³é”®å­—è§¦å‘ï¼ˆå¼€å·¥å•ã€å†…å®¹ã€å†å²ã€å¸®åŠ©ï¼‰
- ğŸ“‹ **å¡ç‰‡ç•Œé¢**ï¼šç®€æ´çš„æœåŠ¡ç±»å‹å’Œä¸¥é‡çº§åˆ«é€‰æ‹©
- ğŸ’¬ **ç¾¤èŠåä½œ**ï¼šå·¥å•åˆ›å»ºåè‡ªåŠ¨åˆ›å»ºé£ä¹¦è®¨è®ºç¾¤èŠ
- ğŸ“Š **æ•°æ®å­˜å‚¨**ï¼šé€šè¿‡DynamoDBå­˜å‚¨å·¥å•ä¿¡æ¯
- ğŸ—ï¸ **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- â˜ï¸ **æ— æœåŠ¡éƒ¨ç½²**ï¼šåŸºäºAWS Lambdaï¼ŒæŒ‰éœ€ä»˜è´¹ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ lambda_function.py      # Lambdaå…¥å£å‡½æ•°
â”œâ”€â”€ utils.py               # é…ç½®ç®¡ç†å’Œå·¥å…·å‡½æ•°
â”œâ”€â”€ ticket_handler.py      # å·¥å•å¤„ç†é€»è¾‘
â”œâ”€â”€ feishu_service.py      # é£ä¹¦APIæœåŠ¡
â”œâ”€â”€ aws_service.py         # AWSæœåŠ¡å°è£…
â”œâ”€â”€ requirements.txt       # ä¾èµ–ç®¡ç†
â”œâ”€â”€ deployment/            # éƒ¨ç½²ç›¸å…³
â”‚   â”œâ”€â”€ template.yaml          # SAMéƒ¨ç½²æ¨¡æ¿
â”‚   â”œâ”€â”€ deploy-serverless.sh  # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ events/               # æµ‹è¯•äº‹ä»¶
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ docs/                  # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ ä½¿ç”¨è¯´æ˜.md            # ä½¿ç”¨æŒ‡å—
â”‚   â”œâ”€â”€ æ— æœåŠ¡éƒ¨ç½²æŒ‡å—.md      # éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ ç¾¤èŠåŠŸèƒ½éªŒè¯æ¸…å•.md    # éªŒè¯æ¸…å•
â”œâ”€â”€ tests/                 # æµ‹è¯•ç›®å½•
â””â”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ç¯å¢ƒé…ç½®

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š
```bash
cp .env.example .env
# æˆ–è€…ä½¿ç”¨configç›®å½•ä¸‹çš„æ¨¡æ¿
cp config/.env.example .env
```

2. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„ä¿¡æ¯ï¼š
```bash
# AWSé…ç½®
AWS_REGION=us-east-1
AWS_ACCOUNT=123456789012
DYNAMODB_TABLE=aws-tickets

# é£ä¹¦åº”ç”¨é…ç½®
FEISHU_APP_ID=cli_a1b2c3d4e5f6g7h8
FEISHU_APP_SECRET=abcdefghijklmnopqrstuvwxyz123456
FEISHU_ENCRYPT_KEY=encrypt_key_example_12345
FEISHU_VERIFICATION_TOKEN=v_token_example_abcdef123456
```

### ä¸€é”®éƒ¨ç½²

```bash
cd deployment
./deploy-serverless.sh
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# æ„å»ºåº”ç”¨
cd deployment
sam build

# éƒ¨ç½²åº”ç”¨
sam deploy --guided  # é¦–æ¬¡éƒ¨ç½²
sam deploy          # åç»­éƒ¨ç½²
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

åœ¨é£ä¹¦ä¸­å‘æœºå™¨äººå‘é€ä»¥ä¸‹å…³é”®å­—ï¼š

| å‘½ä»¤ | åŠŸèƒ½ | ç¤ºä¾‹ |
|------|------|------|
| `å¼€å·¥å•` | åˆ›å»ºæ–°å·¥å• | å¼€å·¥å• EC2å®ä¾‹æ— æ³•å¯åŠ¨ |
| `å†…å®¹` | æŸ¥çœ‹å·¥å•è¯¦æƒ… | å†…å®¹ |
| `å†å²` | æŸ¥çœ‹å†å²å·¥å• | å†å² |
| `å¸®åŠ©` | æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ | å¸®åŠ© |

### å·¥å•åˆ›å»ºæµç¨‹

1. å‘é€ `å¼€å·¥å• [æ ‡é¢˜]` åˆ›å»ºå·¥å•
2. é€‰æ‹©æœåŠ¡ç±»å‹ï¼ˆEC2ã€RDSã€S3ç­‰ï¼‰
3. é€‰æ‹©ä¸¥é‡çº§åˆ«ï¼ˆä½ã€ä¸­ã€é«˜ã€ç´§æ€¥ï¼‰
4. ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºAWSå·¥å•å’Œé£ä¹¦ç¾¤èŠ
5. åœ¨ç¾¤èŠä¸­åä½œè®¨è®ºå’Œè·Ÿè¿›

## ğŸ”§ é…ç½®è¯´æ˜

### æ¨¡å—è¯´æ˜

#### æ ¸å¿ƒæ¨¡å—
- **lambda_function.py**: Lambdaå…¥å£æ–‡ä»¶
  - è¯·æ±‚è·¯ç”±å’Œåˆ†å‘
  - ç»Ÿä¸€é”™è¯¯å¤„ç†
  - å“åº”æ ¼å¼åŒ–

- **utils.py**: é…ç½®ç®¡ç†å’Œå·¥å…·å‡½æ•°
  - ç¯å¢ƒå˜é‡åŠ è½½å’Œé…ç½®ç®¡ç†
  - å¼‚å¸¸å¤„ç†è£…é¥°å™¨
  - æ—¥å¿—ç®¡ç†å’Œé‡è¯•æœºåˆ¶
  - æ•°æ®éªŒè¯å·¥å…·

- **ticket_handler.py**: å·¥å•ä¸šåŠ¡é€»è¾‘
  - å·¥å•åˆ›å»ºå’Œç®¡ç†
  - é£ä¹¦äº‹ä»¶å¤„ç†
  - å¡ç‰‡äº¤äº’å“åº”
  - ä¸šåŠ¡æµç¨‹ç¼–æ’

- **feishu_service.py**: é£ä¹¦APIæœåŠ¡
  - è®¿é—®ä»¤ç‰Œç®¡ç†
  - æ¶ˆæ¯å‘é€å’Œæ¥æ”¶
  - ç¾¤èŠç®¡ç†
  - å¡ç‰‡äº¤äº’å¤„ç†

- **aws_service.py**: AWSæœåŠ¡å°è£…
  - DynamoDBæ•°æ®æ“ä½œ
  - AWS Support APIè°ƒç”¨
  - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### é£ä¹¦åº”ç”¨é…ç½®

1. åœ¨é£ä¹¦å¼€å‘è€…å¹³å°åˆ›å»ºåº”ç”¨
2. é…ç½®æœºå™¨äººæƒé™å’Œäº‹ä»¶è®¢é˜…
3. è·å–åº”ç”¨å‡­è¯ä¿¡æ¯

### AWSé…ç½®

1. ç¡®ä¿AWSè´¦å·æœ‰Support APIæƒé™
2. é…ç½®DynamoDBè¡¨æƒé™
3. è®¾ç½®Lambdaæ‰§è¡Œè§’è‰²

## ğŸ“Š å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·å‘é€æ¶ˆæ¯] --> B[Lambdaæ¥æ”¶äº‹ä»¶]
    B --> C[è§£ææ¶ˆæ¯å†…å®¹]
    C --> D{å‘½ä»¤ç±»å‹}
    D -->|å¼€å·¥å•| E[åˆ›å»ºå·¥å•å¡ç‰‡]
    D -->|å†…å®¹| F[æŸ¥è¯¢å·¥å•è¯¦æƒ…]
    D -->|å†å²| G[æŸ¥è¯¢å†å²è®°å½•]
    D -->|å¸®åŠ©| H[æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯]
    E --> I[ç”¨æˆ·é€‰æ‹©æœåŠ¡ç±»å‹]
    I --> J[åˆ›å»ºAWSå·¥å•]
    J --> K[åˆ›å»ºé£ä¹¦ç¾¤èŠ]
    K --> L[å­˜å‚¨åˆ°DynamoDB]
    L --> M[å‘é€ç¡®è®¤æ¶ˆæ¯]
```

## ğŸ“ ç›‘æ§æ—¥å¿—

æŸ¥çœ‹Lambdaå‡½æ•°æ—¥å¿—ï¼š
```bash
sam logs -n LarkBotFunction --stack-name lark-aws-bot
```

å®æ—¶ç›‘æ§ï¼š
```bash
sam logs -n LarkBotFunction --stack-name lark-aws-bot --tail
```

## ğŸ“š æ›´å¤šæ–‡æ¡£

- [ä½¿ç”¨è¯´æ˜](ä½¿ç”¨è¯´æ˜.md) - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License